<!DOCTYPE html>
<html>
<head>
  <title>Test Supabase Update</title>
</head>
<body>
  <h1>Test Task Update</h1>
  <button onclick="testUpdate()">Test Update Task</button>
  <pre id="result"></pre>

  <script>
    const SUPABASE_URL = 'https://vjfyuqdypacsffuulbdv.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZqZnl1cWR5cGFjc2ZmdXVsYmR2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkwNDg5NDcsImV4cCI6MjA2NDYyNDk0N30.25H6QRkdmLzuYYt2F0NaLznKfzt2vcDjZ2LXFtINfR8';
    
    async function testUpdate() {
      const taskId = 'dbf403a0-d0af-4001-8d03-c6b282ae261d';
      const resultEl = document.getElementById('result');
      
      try {
        // First, get the task
        const getResponse = await fetch(
          `${SUPABASE_URL}/rest/v1/tasks?id=eq.${taskId}&select=*`,
          {
            headers: {
              'apikey': SUPABASE_ANON_KEY,
              'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
            }
          }
        );
        
        const tasks = await getResponse.json();
        resultEl.textContent = 'Current task:\n' + JSON.stringify(tasks, null, 2) + '\n\n';
        
        // Now try to update it
        const updateData = {
          status: 'In Progress',
          last_updated: new Date().toISOString()
        };
        
        resultEl.textContent += 'Attempting update with:\n' + JSON.stringify(updateData, null, 2) + '\n\n';
        
        const updateResponse = await fetch(
          `${SUPABASE_URL}/rest/v1/tasks?id=eq.${taskId}`,
          {
            method: 'PATCH',
            headers: {
              'apikey': SUPABASE_ANON_KEY,
              'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
              'Content-Type': 'application/json',
              'Prefer': 'return=representation'
            },
            body: JSON.stringify(updateData)
          }
        );
        
        const responseText = await updateResponse.text();
        
        if (!updateResponse.ok) {
          resultEl.textContent += 'ERROR ' + updateResponse.status + ':\n';
          resultEl.textContent += responseText;
          
          // Try to parse error
          try {
            const error = JSON.parse(responseText);
            resultEl.textContent += '\n\nParsed error:\n' + JSON.stringify(error, null, 2);
          } catch (e) {
            // Not JSON
          }
        } else {
          resultEl.textContent += 'SUCCESS!\n' + responseText;
        }
        
      } catch (error) {
        resultEl.textContent += 'JavaScript error:\n' + error.toString();
      }
    }
  </script>
</body>
</html>